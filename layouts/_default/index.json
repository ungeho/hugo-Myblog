{{- $.Scratch.Set "index" slice -}}
{{- $.Scratch.Set "seen" dict -}}

{{- $pages := where site.RegularPages "Type" "ne" "page" -}}

{{- range $pages -}}
  {{- if and (not .Params.searchHidden) (ne .Layout "archives") (ne .Layout "search") }}
    {{- $permalink := .Permalink -}}
    {{- if not (index ($.Scratch.Get "seen") $permalink) }}
      {{- $.Scratch.Add "index" (dict
        "title"     .Title
        "content"   .Plain
        "permalink" .Permalink
        "summary"   .Summary
      ) -}}
      {{- $.Scratch.SetInMap "seen" $permalink true -}}
    {{- end }}
  {{- end }}
{{- end }}

{{- $.Scratch.Get "index" | jsonify -}}
